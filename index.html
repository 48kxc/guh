<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>r/place Clone</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #222;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(50, 12px);
      grid-template-rows: repeat(50, 12px);
      gap: 1px;
      margin-top: 20px;
    }
    .pixel {
      width: 12px;
      height: 12px;
      background: #111;
      cursor: pointer;
    }
    #palette {
      margin-top: 10px;
    }
    .color {
      width: 20px;
      height: 20px;
      display: inline-block;
      margin: 0 3px;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .color.selected {
      border-color: white;
    }
  </style>
</head>
<body>
  <h1>r/place Clone</h1>
  <div id="palette"></div>
  <div id="board"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
    import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBzJEbTlcH_wh6Pyeg5E4_41cT_jb8M4Yk",
      authDomain: "image-host-75e78.firebaseapp.com",
      projectId: "image-host-75e78",
      storageBucket: "image-host-75e78.firebasestorage.app",
      messagingSenderId: "10649704767",
      appId: "1:10649704767:web:fed0910f9dfeef86969b8a",
      measurementId: "G-FDX1ZE90JQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const board = document.getElementById("board");
    const palette = document.getElementById("palette");

    const colors = ["#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ff00ff", "#00ffff", "#ffffff", "#000000"];
    let selectedColor = colors[0];

    colors.forEach(color => {
      const c = document.createElement("div");
      c.className = "color";
      c.style.background = color;
      if (color === selectedColor) c.classList.add("selected");
      c.addEventListener("click", () => {
        document.querySelectorAll(".color").forEach(el => el.classList.remove("selected"));
        c.classList.add("selected");
        selectedColor = color;
      });
      palette.appendChild(c);
    });

    for (let y = 0; y < 50; y++) {
      for (let x = 0; x < 50; x++) {
        const pixel = document.createElement("div");
        pixel.className = "pixel";
        pixel.dataset.x = x;
        pixel.dataset.y = y;
        pixel.addEventListener("click", async () => {
          const ref = doc(db, "pixels", `${x}_${y}`);
          await setDoc(ref, { color: selectedColor });
        });
        board.appendChild(pixel);

        const ref = doc(db, "pixels", `${x}_${y}`);
        onSnapshot(ref, snap => {
          if (snap.exists()) {
            pixel.style.background = snap.data().color;
          }
        });
      }
    }
  </script>
</body>
</html>
